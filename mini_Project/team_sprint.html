<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>team sprint</title>
    <link rel="stylesheet" href="style.css" />
</head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    
    <script type="module">

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // Firebase 구성 정보 설정
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyCoVpfV5XDBzOnKJhrZ8rKGTUBsq6t2MLo",
            authDomain: "sparta-30b87.firebaseapp.com",
            projectId: "sparta-30b87",
            storageBucket: "sparta-30b87.appspot.com",
            messagingSenderId: "635188031181",
            appId: "1:635188031181:web:a0cf496b6e87b0e9140384",
            measurementId: "G-QTCRL8DDDJ"
        }

        // 팀원 정보 저장 
        $("#postingbtn").click(async function () {
            let image = $('#image').val();
            let name = $('#name').val();
            let mbti = $('#mbti').val();
            let merit = $('#merit').val();
            let teamstyle = $('#teamstyle').val();
            let favorite = $('#favorite').val();

            let doc = {
                'image': image,
                'name': name,
                'mbti': mbti,
                'merit': merit,
                'teamstyle': teamstyle,
                'favorite': favorite
            };

            await addDoc(collection(db, "teammate"), doc);
            alert("저장 완료");
            window.location.reload();
            var btn = document.createElement("button");
        });

        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let row = null

        //docs 변수 저장
        let docs = await getDocs(collection(db, "teammate"));

        //팀원 카드 
        docs.forEach((doc) => {
            row = doc.data();
            console.log(row)
            let image = row['image'];
            let name = row['name'];
            let mbti = row['mbti'];

            let temp_html = `  <div class="col"  id="${name}" name = "card">
                <div class="card h-100" >
                    <img src="${image}" alt="...">
                    <div class="card-body">
                        <h5 class="card-title">${name}</h5>
                        <p class="card-text">${mbti}</p>
                    </div>
                </div>
            </div>`;
            $('#myteammate').append(temp_html);
        });


        $('.col').click(async function () {
            // 클릭한 대상의 이름 가져오는거 확인용 
            var id_check = $(this).attr("id");
            console.log(id_check);

            docs.forEach((doc) => {
                row = doc.data();
                let image = row['image'];
                let name = row['name'];
                let mbti = row['mbti'];
                let merit = row['merit'];
                let teamstyle = row['teamstyle'];
                let favorite = row['favorite'];

                //모달 바디 생성 
                if (id_check == name) {
                    let temp_html2 = `    
                    <div class="modal_body" id="modal_body">
            <div class="container1">
                <h2 class="name" id="modal_name">${name}</h2>
                <button class="exit_btn" id="exit_btn"></button>
            </div>

            <!-- 사진 -->
            <div class="container2">
                <div class="picture"><img src="${image}" alt="..." class = "picture1">
                </div>

                <!-- 자기소개부분 -->
                <div class="tmi">
                    <div class="mbti" id="modal_mbti"> ${mbti}</div>
                    <div class="merit" id="modal_merit">${merit}</div>
                    <div class="teamstyle" id="modal_teamstyle">${teamstyle}</div>
                    <div class="favorite" id="modal_favorite">${favorite}</div>
                </div>
            </div>

            <!-- 코멘트  -->
            <div class="name_area">
                <h2>coment</h2>
                <p>한마디~~</p>
            </div>
        </div>`;

                    $('#modal').append(temp_html2);
                }
            })
            const btnOpenModal = document.getElementById('myteammate');
            const closeModalBtn = document.getElementById('exit_btn');
            const modal = document.getElementById('modal_body');

            btnOpenModal.addEventListener("click", () => {
                modal.classList.remove('hidden');
            });

            // X버튼으로 모달창 닫기(modal_body 삭제)
            closeModalBtn.addEventListener('click', () => {
                modal.remove('modal_body');
            });

            //window영역 클릭시 모달창 닫기
            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove('modal_body');
                }
            });
        });

    </script>

<body>
    <!-- 팀원 소개 작성 -->
    <div class="mypostingbox" id="postingbox">
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="name" placeholder="name">
            <label for="floatingInput">이름</label>
        </div>
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="image" placeholder="image">
            <label for="floatingInput">이미지</label>
        </div>
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="mbti" placeholder="mbti">
            <label for="floatingInput">mbti</label>
        </div>
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="merit" placeholder="merit">
            <label for="floatingInput">장점</label>
        </div>
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="teamstyle" placeholder="teamstyle">
            <label for="floatingInput">협업스타일</label>
        </div>
        <div class="form-floating mb-3">
            <input type="email" class="form-control" id="favorite" placeholder="favorite">
            <label for="floatingInput">좋아하는것</label>
        </div>
        <button id="postingbtn" type="button" class="btn btn-danger">작성하기</button>
    </div>

    <!-- 팀원카드 -->
    <div class="myteam">
        <div class="row row-cols-1 row-cols-md-4 g-4" id="myteammate">

        </div>
    </div>

    <!-- 모달창  -->
    <div id="modal" class="hidden">

    </div>
    <script type="module" src="script.js"></script> <!-- This enables module support -->

</body>

</html>